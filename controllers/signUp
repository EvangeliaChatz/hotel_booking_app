
import * as model from "../model/model_pg.mjs";

async function signUp (req, res) {
    const email_req = req.body.email;
    const password_req = req.body.password;
    const full_name_req = req.body.full_name;
    const phone_req = req.body.phone_number;
    const client_id = res.locals.user_id;
    
    await model.checkEmail(email_req, (err, result) => {
      if (err) {
        console.log(err);
        res.redirect(req.get("referer"));
      } else {
        if (!result) {
          // Result == null so we can create a new user 
          model.addUser(email_req, password_req, full_name_req, phone_req,client_id, (err, result) => {
            if (err) {
              console.log(err);
              res.redirect(req.get("referer"));
            }
            else {
              // success message , user created 
              res.redirect(req.get("referer") );
            }
          });
        } else {
          // error message , user exists 
          res.redirect(req.get("referer"));
        }
      }
    });
  }

export default signUp;